/*!
 * MinDB (version 0.1.8) - Database on JavaScript
 * 
 * Will Wen Gunn(iwillwen) and other contributors
 * 
 * @license MIT-license
 * @copyright 2012-2015 iwillwen(willwengunn@gmail.com)
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"==typeof exports?exports.min=t():e.min=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){n(1),e.exports=n(1)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,u=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(a){i=!0,u=a}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=n(2),s=r(u),o=n(3),a=n(4),l=r(a),c=n(5),f=r(c),h=n(6),v=r(h),m=n(7),g=r(m),d=n(8),y=r(d),p=n(9),w=r(p),j=n(10),b=s["default"].noop,x={};t["default"]=x,s["default"].extend(x,o.EventEmitter.prototype),x.EventEmitter=o.EventEmitter,x.Promise=o.Promise,x.memStore=j.memStore,x.localStore=j.localStore,x.store=new j.localStore;var k=x._keys={},_=null,P={0:"mix",1:"hash",2:"list",3:"set",4:"zset"};x.fork=function(){for(var e={},t=Object.getOwnPropertyNames(this),n=0;n<t.length;n++){var r=t[n];this.hasOwnProperty(r)&&(e[r]=this[r])}return e},x.del=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?b:arguments[1],r=new o.Promise(b);r.then(function(){t.emit("del",e),_&&clearTimeout(_),_=setTimeout(t.save.bind(t),1e3)});var i=this.store,u="min-"+e;if(i.async){var s=function(){i.remove(u,function(i){return i?(r.reject(i),n(i)):(delete t._keys[e],r.resolve(e),void n(null,e))})};i.ready?s():i.on("ready",s)}else try{i.remove(u),delete this._keys[e],r.resolve(e),n(null,e)}catch(a){r.reject(a),n(a)}return r},x.exists=function(e){var t=arguments.length<=1||void 0===arguments[1]?b:arguments[1],n=new o.Promise;e="min-"+e;var r=function(e,r){return e||!r?(n.resolve(!1),t(null,!1)):(n.resolve(!0),void t(null,!0))};if(this.store.async)this.store.get(e,r);else{var i=this.store.get(e);r(null,i)}return n},x.renamenx=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?b:arguments[2],i=new o.Promise(b);i.then(function(){n.emit("rename",e,t),_&&clearTimeout(_),_=setTimeout(n.save.bind(n),5e3)});try{var u=function(e){i.reject(e),r(e)},s=null,a=null;this.exists(e).then(function(t){if(t)return n.get(e);var r=new Error("no such key");u(r)}).then(function(t){return s=n._keys[e],a=t,n.del(e)}).then(function(){return n.set(t,a,r)}).then(function(){n._keys[t]=s,i.resolve("OK"),r(null,"OK")},u)}catch(l){u(l)}return i},x.rename=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?b:arguments[2],i=new o.Promise(b);i.then(function(){n.emit("rename",e,t),_&&clearTimeout(_),_=setTimeout(n.save.bind(n),5e3)});var u=function(e){i.reject(e),r(e)};return e==t?u(new Error("The key is equal to the new key.")):this.renamenx.apply(this,arguments).then(i.resolve.bind(i),i.reject.bind(i)),i},x.keys=function(e){var t=arguments.length<=1||void 0===arguments[1]?b:arguments[1],n=new o.Promise,r=Object.keys(this._keys),i=e.replace("?","(.)").replace("*","(.*)");i=new RegExp(i);for(var u=[],s=0;s<r.length;s++)r[s].match(i)&&u.push(r[s]);return n.resolve(u),t(null,u),n},x.randomkey=function(){var e=arguments.length<=0||void 0===arguments[0]?b:arguments[0],t=new o.Promise(b),n=Object.keys(this._keys),r=Math.round(Math.random()*(n.length-1)),i=n[r];return t.resolve(i),e(null,i),t},x.type=function(e){var t=arguments.length<=1||void 0===arguments[1]?b:arguments[1],n=new o.Promise(b);return this._keys.hasOwnProperty(e)?(n.resolve(P[this._keys[e]]),t(null,t)):(n.resolve(null),t(null,null)),n},x.empty=function(){function e(t){t?i.del(t,function(t){t||s++,e(u.shift())}):(r.resolve(s),n(null,s))}var t=this,n=arguments.length<=0||void 0===arguments[0]?b:arguments[0],r=new o.Promise,i=this,u=Object.keys(this._keys),s=0;return r.then(function(e){t.emit("empty",e),_&&clearTimeout(_),_=setTimeout(t.save.bind(t),5e3)}),e(u.shift()),r},x.save=function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?b:arguments[0],n=new o.Promise;return n.then(function(t){var n=i(t,2),r=n[0],u=n[1];e.emit("save",r,u)}),this.set("min_keys",JSON.stringify(this._keys)).then(function(){return e.dump()}).then(function(e){var r=i(e,2),u=r[0],s=r[1];n.resolve([u,s]),t(u,s)},function(e){n.reject(e),t(e)}),n},x.dump=function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?b:arguments[0],n=null,r=new o.Promise,i={};return this.keys("*",function(u,s){return u?(r.reject(u),t(u)):void(n=function(u){if(u)e.get(u).then(function(e){i[u]=e,n(s.shift())},function(e){r.reject(e),t(e)});else{var o=JSON.stringify(i);r.resolve([i,o]),t(null,i,o)}})(s.shift())}),r},x.restore=function(e){function t(n){n?u.set(n,e[n]).then(function(){t(s.shift())},function(e){i.reject(e),r(e)}):a()}var n=this,r=arguments.length<=1||void 0===arguments[1]?b:arguments[1],i=new o.Promise,u=this;i.then(function(){n.save(function(){n.emit("restore")})});var s=Object.keys(e),a=function(){n.exists("min_keys").then(function(e){return e?n.get("min_keys"):(i.resolve(),void r())}).then(function(e){k=JSON.parse(e),i.resolve(),r()})["catch"](function(e){i.rejeect(e),r(e)})};return t(s.shift()),i};var O={};x.watch=function(e,t,n){var r=this;"undefined"==typeof n&&t.apply&&(n=t,t="set");var i=Math.random().toString(32).substr(2);return O[e]||(O[e]={}),O[e][i]=function(t){for(var i=arguments.length,u=Array(i>1?i-1:0),s=1;i>s;s++)u[s-1]=arguments[s];t===e&&n.call.apply(n,[r].concat(u))},O[e][i].command=t,this.on(t,O[e][i]),i},x.unwatch=function(e,t,n){"undefined"==typeof n&&t&&(n=t,t="set"),this.removeListener(t,O[e][n])},x.unwatchForKey=function(e){var t=O[e];for(var n in t){var r=t[n];this.removeListener(r.command,r)}},s["default"].extend(x,f["default"]),s["default"].extend(x,v["default"]),s["default"].extend(x,g["default"]),s["default"].extend(x,y["default"]),s["default"].extend(x,w["default"]),s["default"].extend(x,l["default"]);var E=function(e,t){if(e||!t)return void(x._keys={});try{x._keys=JSON.parse(keys)}catch(e){x._keys={}}};if(x.store.async)x.store.get("min-min_keys",E);else try{var S=x.store.get("min-min_keys");E(null,S)}catch(A){E(A)}e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={noop:function(){return!1},inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];for(var r=t[0],i=[].slice.call(t,1),u=0,s=i.length;s>u;u++){var o=Object.getOwnPropertyNames(i[u]||{}),a=!0,l=!1,c=void 0;try{for(var f,h=o[Symbol.iterator]();!(a=(f=h.next()).done);a=!0){var v=f.value;r[v]=i[u][v]}}catch(m){l=!0,c=m}finally{try{!a&&h["return"]&&h["return"]()}finally{if(l)throw c}}}return r},isNumber:function(e){return"[object Number]"==toString.call(e)},isUndefined:function(e){return void 0===e},isObject:function(e){return e===Object(e)},arrayUnique:function(e){for(var t={},n=[],r=0,i=e.length;i>r;++r)(!t.hasOwnProperty(e[r])||utils.isObject(e[r]))&&(n.push(e[r]),t[e[r]]=1);return n},arrayInter:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return utils.arrayUnique(e).filter(function(e){var t=!0,r=!0,i=!1,u=void 0;try{for(var s,o=n[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var a=s.value;a.indexOf(e)<0&&(t=!1)}}catch(l){i=!0,u=l}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw u}}return t})},arrayDiff:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return e.filter(function(e){var t=!0,r=!0,i=!1,u=void 0;try{for(var s,o=n[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var a=s.value;a.indexOf(e)>=0&&(t=!1)}}catch(l){i=!0,u=l}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw u}}return t})},flatten:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,n,r){for(var i=[],u=0,s=r||0,o=getLength(e);o>s;s++){var a=e[s];if(isArrayLike(a)&&(_.isArray(a)||_.isArguments(a))){t||(a=flatten(a,t,n));var l=0,c=a.length;for(i.length+=c;c>l;)i[u++]=a[l++]}else n||(i[u++]=a)}return i})},e.exports=t["default"]},function(e,t,n){(function(e){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e){var t=null,n=l,r=l;return e=e||l,v?(t=new v(function(t,i){n=t,r=i,e(t,i)}),t.resolve=function(){for(var e=arguments.length,r=Array(e),i=0;e>i;i++)r[i]=arguments[i];n.apply(t,r)},t.reject=function(){for(var e=arguments.length,n=Array(e),i=0;e>i;i++)n[i]=arguments[i];r.apply(t,n)}):t=new h(e),t}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.Promise=u;var o=n(2),a=r(o),l=a["default"].noop,c=10,f=function(){function e(){i(this,e),this._events=this._events||{},this._maxListeners=this._maxListeners||c}return s(e,[{key:"setMaxListeners",value:function(e){if("number"!=typeof e||0>e)throw TypeError("n must be a positive number");this._maxListeners=e}},{key:"emit",value:function(e){var t,n,r,i,u,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||"object"==typeof this._events.error&&!this._events.error.length)){if(t=arguments[1],!this.domain)throw t instanceof Error?t:TypeError('Uncaught, unspecified "error" event.');return t||(t=new TypeError('Uncaught, unspecified "error" event.')),!1}if(n=this._events[e],"undefined"==typeof n)return!1;if("function"==typeof n)switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,i=new Array(r-1),u=1;r>u;u++)i[u-1]=arguments[u];n.apply(this,i)}else if("object"==typeof n){for(r=arguments.length,i=new Array(r-1),u=1;r>u;u++)i[u-1]=arguments[u];for(s=n.slice(),r=s.length,u=0;r>u;u++)s[u].apply(this,i)}return!0}},{key:"addListener",value:function(e,t){var n;if("function"!=typeof t)throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,"function"==typeof t.listener?t.listener:t),this._events[e]?"object"==typeof this._events[e]?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,"object"!=typeof this._events[e]||this._events[e].warned||(n=this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())),this}},{key:"once",value:function(e,t){function n(){this.removeListener(e,n),t.apply(this,arguments)}if("function"!=typeof t)throw TypeError("listener must be a function");return n.listener=t,this.on(e,n),this}},{key:"removeListener",value:function(e,t){var n,r,i,u;if("function"!=typeof t)throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],i=n.length,r=-1,n===t||"function"==typeof n.listener&&n.listener===t)this._events[e]=void 0,this._events.removeListener&&this.emit("removeListener",e,t);else if("object"==typeof n){for(u=i;u-->0;)if(n[u]===t||n[u].listener&&n[u].listener===t){r=u;break}if(0>r)return this;1===n.length?(n.length=0,this._events[e]=void 0):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this}},{key:"removeAllListeners",value:function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&(this._events[e]=void 0),this;if(0===arguments.length){for(var r=Object.keys(this._events),i=0;i<r.length;i++){var t=r[i];"removeListener"!==t&&this.removeAllListeners(t)}return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],"function"==typeof n)this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return this._events[e]=void 0,this}},{key:"listeners",value:function(e){var t;return t=this._events&&this._events[e]?"function"==typeof this._events[e]?[this._events[e]]:this._events[e].slice():[]}}]),e}();t.EventEmitter=f,f.prototype.on=f.prototype.addListener,f.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?"function"==typeof e._events[t]?1:e._events[t].length:0},f.inherits=function(e){a["default"].inherits(e,f)};var h=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?l:arguments[0];i(this,e),this._settled=!1,this._success=!1,this._args=[],this._callbacks=[],this._onReject=l,t(this.resolve.bind(this),this.reject.bind(this))}return s(e,[{key:"then",value:function(t){var n=this,r=arguments.length<=1||void 0===arguments[1]?l:arguments[1],i=new e;return this._onReject=r,this._callbacks.push(function(){for(var e=arguments.length,r=Array(e),u=0;e>u;u++)r[u]=arguments[u];var s=t.apply(n,r);s&&"function"==typeof s.then&&s.then(i.resolve.bind(i),i.reject.bind(i))}),this._settled&&(this._success?this.resolve.apply(this,this._args):this.onReject.apply(this,this._args)),i}},{key:"catch",value:function(e){return this._onReject=e,this}},{key:"resolve",value:function(){for(var e=!0,t=!1,n=void 0,r=arguments.length,i=Array(r),u=0;r>u;u++)i[u]=arguments[u];try{for(var s,o=this._callbacks[Symbol.iterator]();!(e=(s=o.next()).done);e=!0){var a=s.value;a.apply(this,i)}}catch(l){t=!0,n=l}finally{try{!e&&o["return"]&&o["return"]()}finally{if(t)throw n}}this._args=i,this._settled=!0,this._success=!0}},{key:"reject",value:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this._onReject.apply(this,t),this._args=t,this._settled=!0}}]),e}(),v=(e||window).Promise||null}).call(t,function(){return this}())},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,u=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(a){i=!0,u=a}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=n(2),s=r(u),o=n(3),a=s["default"].noop,l={};t["default"]=l;var c=null;l.set=function(e,t,n){var r=this,i=new o.Promise;i.then(function(){r.emit("set",e,t),c&&clearTimeout(c),c=setTimeout(r.save.bind(r),1e3)});var u=this.store;n=n||s["default"].noop;var a="min-"+e;if(u.async){var l=function(){var s=JSON.stringify(t);u.set(a,s,function(u){return u?(i.reject(u),n(u)):(r._keys[e]=0,i.resolve([e,t]),void n(null,e,t))})};u.ready?l():u.on("ready",l)}else{var f=JSON.stringify(t);u.set(a,f),this._keys[e]=0,i.resolve([e,t]),n(null,e,t)}return i},l.setnx=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],u=new o.Promise;return this.exists(e,function(s,o){return s&&(r(s),u.reject(s)),o?u.reject(new Error("The key is exists.")):void n.set(e,t,r).then(function(e){var t=i(e,2),n=t[0],s=t[1];r(null,n,s),u.resolve([n,s])},function(e){r(e),u.reject(e)})}),u},l.setex=function(e,t,n){var r=this,u=arguments.length<=3||void 0===arguments[3]?a:arguments[3],s=new o.Promise,l=function(){r.del(e,a)};return this.set(e,n,function(e,n){setTimeout(l,1e3*t),u(e,n)}).then(function(e){var n=i(e,2),r=n[0],o=n[1];setTimeout(l,1e3*t),s.resolve([r,o]),u(null,r,o)},function(e){s.reject(e),u(e)}),s},l.psetex=function(e,t,n){var r=this,u=arguments.length<=3||void 0===arguments[3]?a:arguments[3],l=new o.Promise,c=function(){r.del(e,s["default"].noop)};return this.set(e,n,function(e,n){setTimeout(c,t),u(e,n)}).then(function(e){var n=i(e,2),r=n[0],s=n[1];setTimeout(c,t),l.resolve([r,s]),u(null,r,s)},l.reject.bind(l)),l},l.mset=function(e){function t(){f.length>0?(r(f),u.reject(f)):(r(null,c),u.resolve(c))}var n=this,r=arguments.length<=1||void 0===arguments[1]?a:arguments[1],u=new o.Promise,s=Object.keys(e),l=0,c=[],f=[],h=function v(r,u){delete s[u],n.set(r,e[r]).then(function(e){var n=i(e,2),r=n[0],u=n[1];c.push([r,u]),l++,s[l]?v(s[l],l):t()},function(e){return f.push(e),l++,s[l]?v(s[l],l):t()})};return h(s[l],l),u},l.msetnx=function(e){function t(){return f.length?(r(f),u.reject(f)):(r(null,c),void u.resolve(c))}var n=this,r=arguments.length<=1||void 0===arguments[1]?a:arguments[1],u=new o.Promise,s=Object.keys(e),l=0,c=[],f=[],h=function v(r,u){delete s[u],n.setnx(r,e[r]).then(function(e){var n=i(e,2),r=n[0],u=n[1];c.push([r,u]),l++,s[l]?v(s[l],l):t()},function(e){f.push(e),t()})};return h(s[l],l),u},l.append=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return this.exists(e).then(function(t){if(t)return n.get(e);var r=new o.Promise;return r.resolve(""),r}).then(function(r){return n.set(e,r+t)}).then(function(){return n.strlen(e)}).then(function(e){i.resolve(e),r(null,e)})["catch"](function(e){i.reject(e),r(e)}),i},l.get=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise;r.then(function(n){return t.emit("get",e,n)});var i=this.store,u="min-"+e;if(i.async){var s=function(){i.get(u,function(e,t){if(e){var i=new Error("no such key");return r.reject(i),n(i)}if(t)try{var u=JSON.parse(t);r.resolve(u),n(null,u)}catch(e){r.reject(e),n(e)}else{var e=new Error("no such key");r.reject(e),n(e)}})};i.ready?s():i.on("ready",s)}else try{var l=this.store.get(u);if(l)try{var c=JSON.parse(l);r.resolve(c),n(null,c)}catch(f){r.reject(f),n(f)}else{var f=new Error("no such key");r.reject(f),n(f)}}catch(f){r.reject(f),n(f)}return r},l.getrange=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?a:arguments[3],u=new o.Promise;u.then(function(i){return r.emit("getrange",e,t,n,i)});var s=n-t+1;return this.get(e).then(function(e){var n=e.substr(t,s);u.resolve(n),i(null,n)},function(e){u.reject(e),i(e)}),u},l.mget=function(e){for(var t=arguments.length<=1||void 0===arguments[1]?a:arguments[1],n=new o.Promise,r=0,i=this.multi(),r=0;r<e.length;r++)i.get(e[r]);return i.exec(function(e,r){if(e)return t(e),n.reject(e);var i=r.map(function(e){return e[0]});t(e),n.resolve(i)}),n},l.getset=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;i.then(function(r){return n.emit("getset",e,t,r)});var u=null;return this.get(e).then(function(r){return u=r,n.set(e,t)}).then(function(){i.resolve(u),r(null,u)},function(e){i.reject(e),r(e)}),i},l.strlen=function(e){var t=arguments.length<=1||void 0===arguments[1]?a:arguments[1],n=new o.Promise;return this.get(e).then(function(e){if("string"==typeof e){var r=e.length;n.resolve(r),t(null,r)}else{var i=new TypeError;n.reject(i),t(i)}})["catch"](function(e){n.reject(e),t(e)}),n},l.incr=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise;return r.then(function(n){return t.emit("incr",e,n)}),this.exists(e).then(function(n){if(n)return t.get(e);var r=new o.Promise;return r.resolve(0),r}).then(function(i){return isNaN(parseInt(i))?(r.reject("value wrong"),n("value wrong")):(i=parseInt(i),t.set(e,++i))}).then(function(e){var t=i(e,2),u=t[0],s=t[1];r.resolve(s),n(null,s,u)})["catch"](function(e){r.reject(e),n(e)}),r},l.incrby=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return i.then(function(r){return n.emit("incrby",e,t,r)}),this.exists(e).then(function(t){if(t)return n.get(e);var r=new o.Promise;return r.resolve(0),r}).then(function(u){return isNaN(parseFloat(u))?(i.reject("value wrong"),r("value wrong")):(u=parseFloat(u),n.set(e,u+t))}).then(function(e,t){i.resolve(t),r(null,t)},function(e){i.reject(e),r(e)}),i},l.incrbyfloat=l.incrby,l.decr=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise;return r.then(function(n){return t.emit("decr",e,n)}),this.exists(e).then(function(n){if(n)return t.get(e);var r=new o.Promise;return r.resolve(0),r}).then(function(i){return isNaN(parseInt(i))?(r.reject("value wrong"),n("value wrong")):(i=parseInt(i),t.set(e,--i))}).then(function(e){var t=i(e,2),u=t[0],s=t[1];r.resolve(s),n(null,s,u)},function(e){r.reject(e),n(e)}),r},l.decrby=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return i.then(function(r){return n.emit("decrby",e,t,r)}),this.exists(e).then(function(t){if(t)return n.get(e);var r=new o.Promise;return r.resolve(0),r}).then(function(u){return isNaN(parseInt(u))?(i.reject("value wrong"),r("value wrong")):(u=parseInt(u),n.set(e,u-t))}).then(function(e,t){i.resolve(t),r(null,t)},function(e){i.reject(e),r(e)}),i},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,u=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(a){i=!0,u=a}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=n(2),s=r(u),o=n(3),a=s["default"].noop,l={};t["default"]=l,l.hset=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?a:arguments[3],u=new o.Promise;return this.exists(e,function(s,o){if(s)return u.reject(s),i(s);if(o)r.get(e,function(s,o){return s?(u.reject(s),i(s)):(o[t]=n,void r.set(e,o,function(r){return r?(u.reject(r),i(r)):(u.resolve([e,t,n]),void i(null,e,t,n))}))});else{var a={};a[t]=n,r.set(e,a,function(s){return s?(reject(s),i(s)):(r._keys[e]=1,u.resolve([e,t,n]),void i(null,e,t,n))})}}),u.then(function(){r.emit("hset",e,t,n)}),u},l.hsetnx=function(e,t,n){var r=this,u=arguments.length<=3||void 0===arguments[3]?a:arguments[3],s=new o.Promise;return this.hexists(e,t,function(o,a){if(o)return s.reject(o),u(o);if(a){var o=new Error("The field of the hash is exists");return s.reject(o),u(o)}r.hset(e,t,n).then(function(e){var t=i(e,3),n=t[0],r=t[1],o=t[2];s.resolve([n,r,o]),u(null,n,r,o)})}),s},l.hmset=function(e,t){function n(){h.length>0?(u(h),s.reject(h)):(u(null,f),s.resolve(f))}var r=this,u=arguments.length<=2||void 0===arguments[2]?a:arguments[2],s=new o.Promise,l=Object.keys(t),c=0,f=[],h=[],v=function m(u,s){delete l[s],r.hset(e,u,t[u]).then(function(e){var t=i(e,3),r=t[0],u=t[1],s=t[2];f.push([r,u,s]),c++,l[c]?m(l[c],c):n()},function(e){return h.push(e),c++,l[c]?m(l[c],c):n()})};return v(l[c],c),s},l.hget=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return this.hexists(e,t,function(u,s){if(u)return i.reject(u),r(u);if(s)n.get(e).then(function(e){var n=e[t];i.resolve(n),r(null,n)},function(e){i.reject(e),r(e)});else{var u=new Error("no such field");i.reject(u),r(u)}}),i},l.hmget=function(e,t){var n=arguments.length<=2||void 0===arguments[2]?a:arguments[2],r=new o.Promise,i=[],u=this.multi();return t.forEach(function(t){u.hget(e,t)}),u.exec(function(e,t){return e?(n(e),r.reject(e)):(i=t.map(function(e){return e[0]}),r.resolve(i),void n(null,i))}),r},l.hgetall=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise;return this.exists(e,function(i,u){if(i)return n(i),r.reject(i);if(!u){var i=new Error("no such key");return n(i),r.reject(i)}t.get(e).then(function(e){r.resolve(e),n(null,e)})["catch"](function(e){r.reject(e),n(e)})}),r},l.hdel=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],u=new o.Promise;return u.then(function(e){var t=i(e,3),r=t[0],u=t[1],s=t[2];n.emit("hdel",r,u,s)}),this.hexists(e.field,function(i,s){if(i)return r(i),u.reject(i);if(!s){var i=new Error("no such key");return r(i),u.reject(i)}n.get(e).then(function(i){var s=i[t];delete i[t],n.set(e,i).then(function(){u.resolve([e,t,s]),r(null,e,t,s)},function(e){u.reject(e),r(e)})},function(e){r(e)})}),u},l.hlen=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise;return this.exists(e,function(i,u){return i?(r.reject(i),n(i)):void(u?t.get(e).then(function(e){var t=Object.keys(e).length;r.resolve(t),n(null,t)},function(e){r.reject(e),n(e)}):(r.resolve(0),n(null,0)))}),r},l.hkeys=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise;return this.exists(e,function(i,u){return i?(r.reject(i),n(i)):void(u?t.get(e).then(function(e){var t=Object.keys(e);r.resolve(t),n(null,t)},function(e){r.reject(e),n(e)}):(r.resolve(0),n(null,0)))}),r},l.hexists=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return this.exists(e).then(function(t){return t?n.get(e):(i.resolve(!1),void r(null,!1))}).then(function(e){e.hasOwnProperty(t)?(i.resolve(!0),r(null,!0)):(i.resolve(!1),r(null,!1))},function(e){i.reject(e),r(e)}),i},l.hincr=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return i.then(function(r){n.emit("hincr",e,t,r)}),this.hexists(e,t).then(function(e){if(e)return n.hget(e);var t=new o.Promise;return t.resolve(0),t}).then(function(u){return isNaN(parseFloat(u))?(i.reject("value wrong"),r("value wrong")):(u=parseFloat(u),n.hset(e,t,++u))}).then(function(e,t,n){i.resolve(n),r(null,n)},function(e){i.reject(e),r(null,e)}),i},l.hincrby=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?a:arguments[3],u=new o.Promise;return u.then(function(n){r.emit("hincr",e,t,n)}),this.hexists(e,t).then(function(e){if(e)return r.hget(e);var t=new o.Promise;return t.resolve(0),t}).then(function(s){return isNaN(parseFloat(s))?(u.reject("value wrong"),i("value wrong")):(s=parseFloat(s),r.hset(e,t,s+n))}).then(function(e,t,n){u.resolve(n),i(null,n)},function(e){u.reject(e),i(null,e)}),u},l.hincrbyfloat=l.hincrby,l.hdecr=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return i.then(function(r){n.emit("hdecr",e,t,r)}),this.hexists(e,t).then(function(r){if(r)return n.hget(e,t);var i=new o.Promise;return i.resolve(0),i}).then(function(u){return isNaN(parseFloat(u))?(i.reject("value wrong"),r("value wrong")):(u=parseFloat(u),n.hset(e,t,--u))}).then(function(e,t,n){i.resolve(n),r(null,n)},function(e){i.reject(e),r(e)}),i},l.hdecrby=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?a:arguments[3],u=new o.Promise;return u.then(function(n){r.emit("hincr",e,t,n)}),this.hexists(e,t).then(function(e){if(e)return r.hget(e);var t=new o.Promise;return t.resolve(0),t}).then(function(s){return isNaN(parseFloat(s))?(u.reject("value wrong"),i("value wrong")):(s=parseFloat(s),r.hset(e,t,s-n))}).then(function(e,t,n){u.resolve(n),i(null,n)},function(e){u.reject(e),i(null,e)}),u},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,u=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(a){i=!0,u=a}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=n(2),s=r(u),o=n(3),a=s["default"].noop,l={};t["default"]=l,l.lpush=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return i.then(function(r){return n.emit("lpush",e,t,r)}),this.exists(e,function(u,s){if(u)return i.reject(u),r(u);if(s)n.get(e,function(u,s){return u?(i.reject(u),r(u)):(s.unshift(t),void n.set(e,s,function(e){if(e)return i.reject(e),r(e);var t=s.length;i.resolve(t),r(null,t)}))});else{var o=[t];n.set(e,o,function(t){return t?(i.reject(t),r(t)):(n._keys[e]=2,i.resolve(1),void r(null,1))})}}),i},l.lpushx=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return i.then(function(r){return n.emit("lpush",e,t,r)}),this.exists(e,function(u,s){if(u)return i.reject(u),r(u);if(!s){var u=new Error("no such key");return r(u),i.reject(u)}n.get(e,function(u,s){if(u)return i.reject(u),r(u);if(!s.length){var u=new Error("The list is empty.");return r(u),i.reject(u)}s.unshift(t),n.set(e,s,function(e){if(e)return i.reject(e),r(e);var t=s.length;i.resolve(t),r(null,t)})})}),i},l.rpush=function(e,t,n){var r=this,i=new o.Promise;return i.then(function(n){return r.emit("rpush",e,t,n)}),this.exists(e,function(u,s){if(u)return i.reject(u),n(u);if(s)r.get(e,function(u,s){return u?(i.reject(u),n(u)):(s.push(t),void r.set(e,s,function(e){if(e)return i.reject(e),n(e);var t=s.length;i.resolve(t),n(null,t)}))});else{var o=[t];r.set(e,o,function(e){return e?(i.reject(e),n(e)):(i.resolve(1),void n(null,1))})}}),i},l.rpushx=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return i.then(function(r){return n.emit("rpush",e,t,r)}),this.exists(e,function(u,s){if(u)return i.reject(u),r(u);if(!s){var u=new Error("no such key");return r(u),i.reject(u)}n.get(e,function(u,s){if(u)return i.reject(u),r(u);if(!s.length){var u=new Error("The list is empty.");return r(u),i.reject(u)}s.push(t),n.set(e,s,function(e){if(e)return i.reject(e),r(e);var t=s.length;i.resolve(t),r(null,t)})})}),i},l.lpop=function(e,t){var n=this,r=new o.Promise,i=null;return r.then(function(t){return n.emit("lpop",e,t)}),this.exists(e).then(function(i){return i?n.get(e):(r.resolve(null),void t(null,null))}).then(function(t){return i=t.shift(),n.set(e,t)}).then(function(){r.resolve(i),t(null,i)},function(e){r.reject(e),t(e)}),r},l.rpop=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise;r.then(function(n){return t.emit("rpop",e,n)});var i=null;return this.exists(e).then(function(i){return i?t.get(e):(r.resolve(null),void n(null,null))}).then(function(n){return i=n.pop(),t.set(e,n)}).then(function(){r.resolve(i),n(null,i)},function(e){r.reject(e),n(e)}),r},l.llen=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise;return this.exists(e,function(i,u){return i?(r.reject(i),n(i)):void(u?t.get(e,function(e,t){if(e)return r.reject(e),n(e);var i=t.length;r.resolve(i),n(null,i)}):(r.resolve(0),n(null,0)))}),r},l.lrange=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?a:arguments[3],u=new o.Promise;return this.exists(e,function(s,o){return s?(u.reject(s),i(s)):void(o?r.get(e,function(e,r){if(e)return u.reject(e),i(e);var s=r.slice(t,n+1);u.resolve(s),i(null,s)}):(u.resolve(null),i(null,null)))}),u},l.lrem=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?a:arguments[3],u=new o.Promise;return u.then(function(i){return r.emit("lrem",e,t,n,i)}),this.exists(e,function(s,o){return s?(u.reject(s),i(s)):void(o?r.get(e,function(e,r){if(e)return u.reject(e),i(e);var s=0;switch(!0){case t>0:for(var o=0;o<r.length&&t>s;o++)r[o]===n&&(r.splice(o,1)[0],s++);break;case 0>t:for(var o=r.length-1;o>=0&&t>s;o--)r[o]===n&&(r.splice(o,1)[0],s++);break;case t=0:for(var o=r.length-1;o>=0;o--)r[o]===n&&(r.splice(o,1)[0],s++)
}u.resolve(s),i(null,s)}):(u.resolve(null),i(null,null)))}),u},l.lset=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?a:arguments[3],u=new o.Promise;return u.then(function(i){return r.emit("lset",e,t,n,i)}),this.exists(e,function(s,o){if(s)return u.reject(s),i(s);if(!o){var s=new Error("no such key");return u.reject(s),i(s)}r.get(e,function(s,o){if(s)return u.reject(s),i(s);if(!o[t]||!o.length){var s=new Error("no such key");return u.reject(s),i(s)}o[t]=n,r.set(e,o,function(e){if(e)return u.reject(e),i(e);var t=o.length;u.resolve(t),i(null,t)})})}),u},l.ltrim=function(e,t,n){var r=this,u=arguments.length<=3||void 0===arguments[3]?a:arguments[3],s=new o.Promise;return this.exists(e).then(function(t){return t?r.get(e):(s.resolve(null),u(null,null))}).then(function(i){var u=i.splice(t,n+1);return r.set(e,u)}).then(function(e){var t=i(e,2),n=t[0],r=t[1];s.resolve(r),u(null,r,n)})["catch"](function(e){s.reject(e),u(e)}),s},l.lindex=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise;return this.exists(e).then(function(t){if(!t){var u=new Error("no such key");return i.reject(u),r(u)}return n.get(e)}).then(function(e){var n=e[t];i.resolve(n),r(null,n)})["catch"](function(e){i.reject(e),r(e)}),i},l.linsertBefore=function(e,t,n,r){var i=this,u=new o.Promise;return u.then(function(r){return i.emit("linsertBefore",e,t,n,r)}),this.exists(e,function(s,o){return s?(u.reject(s),r(s)):void(o?i.get(e,function(s,o){if(s)return u.reject(s),r(s);var a=o.indexOf(t);return 0>a?(u.resolve(null),r(null,null)):(o.splice(a,1,n,t),void i.set(e,o,function(e){if(e)return u.reject(e),r(e);var t=o.length;u.resolve(t),r(null,t)}))}):(u.resolve(null),r(null,null)))}),u},l.linsertAfter=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?a:arguments[3],u=new o.Promise;return u.then(function(i){return r.emit("linsertAfter",e,t,n,i)}),this.exists(e,function(s,o){return s?(u.reject(s),i(s)):void(o?r.get(e,function(s,o){if(s)return u.reject(s),i(s);var a=o.indexOf(t);return 0>a?(u.resolve(null),i(null,null)):(o.splice(a,0,n),void r.set(e,o,function(e){if(e)return u.reject(e),i(e);var t=o.length;u.resolve(t),i(null,t)}))}):(u.resolve(null),i(null,null)))}),u},l.rpoplpush=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],u=new o.Promise,s=null;return u.then(function(r){var u=i(r,2),s=u[0],o=u[1];return n.emit("rpoplpush",e,t,s,o)}),this.rpop(e).then(function(e){return n.lpush(t,s=e)}).then(function(e){u.resolve([s,e]),r(null,s,e)},function(e){r(e),u.reject(e)}),u},l.lpoprpush=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise,u=null;return i.then(function(r,i){return n.emit("lpoprpush",e,t,r,i)}),this.lpop(e).then(function(e){return n.rpush(t,u=e)}).then(function(e){i.resolve(u,e),r(null,u,e)},function(e){r(e),i.reject(e)}),i},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,u=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(a){i=!0,u=a}finally{try{!r&&o["return"]&&o["return"]()}finally{if(i)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=n(2),s=r(u),o=n(3),a=s["default"].noop,l={};t["default"]=l,l.sadd=function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;n>i;i++)r[i-1]=arguments[i];var u=new o.Promise(a);u.then(function(n){return t.emit("sadd",e,n)});var l=0;if(r[r.length-1]instanceof Function)var c=r.splice(r.length-1,1)[0];else var c=a;return this.exists(e).then(function(n){if(n)return t.get(e);var i=s["default"].arrayUnique(r);return t.set(e,i)}).then(function(){if(Array.isArray(arguments[0])){var n=arguments[0],i=!0,s=!1,o=void 0;try{for(var a,f=r[Symbol.iterator]();!(i=(a=f.next()).done);i=!0){var h=a.value;if(n.indexOf(h)>=0)return;n.push(h),l++}}catch(v){s=!0,o=v}finally{try{!i&&f["return"]&&f["return"]()}finally{if(s)throw o}}return t.set(e,n)}"string"==typeof arguments[0]&&(l+=r.length,t._keys[e]=3,u.resolve(l),c(null,l))}).then(function(){t._keys[e]=3,u.resolve(l),c(null,l)},function(e){u.reject(e),c(e)}),u},l.srem=function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;n>i;i++)r[i-1]=arguments[i];var u=new o.Promise(a),s=a;u.then(function(n){return t.emit("srem",e,r,n)});var l=0;return r[r.length-1]instanceof Function&&(s=r.pop()),this.exists(e).then(function(n){return n?t.get(e):new Error("no such key")}).then(function(n){var i=!0,u=!1,s=void 0;try{for(var o,a=r[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var c=o.value,f=n.indexOf(c);f>=0&&(n.splice(f,1),l++)}}catch(h){u=!0,s=h}finally{try{!i&&a["return"]&&a["return"]()}finally{if(u)throw s}}return t.set(e,n)}).then(function(){t._keys[e]=3,u.resolve(l),s(null,l)},function(e){u.reject(e),s(e)}),u},l.smembers=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise(a);return this.exists(e).then(function(n){return n?t.get(e):new Error("no such key")}).then(function(e){r.resolve(e),n(null,e)},function(e){r.reject(e),n(e)}),r},l.sismember=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?a:arguments[2],i=new o.Promise(a);return this.exists(e).then(function(t){return t?n.get(e):new Error("no such key")}).then(function(e){var n=e.indexOf(t)>=0?1:0;i.resolve(n),r(null,n)},function(e){i.reject(e),r(e)}),i},l.scard=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise(a);return this.exists(e).then(function(n){return n?t.get(e):new Error("no such key")}).then(function(e){var t=e.length;r.resolve(t),n(null,t)},function(e){r.reject(e),n(e)}),r},l.smove=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?a:arguments[3],u=new o.Promise(a);return u.then(function(i){return r.emit("smove",e,t,n,i)}),this.exists(key).then(function(t){return t?r.sismember(e,n):new Error("no such key")}).then(function(t){return t?r.srem(e,n):new Error("no such member")}).then(function(){return r.sismember(t,n)}).then(function(e){return e?(r._keys[key]=3,u.resolve(0),i(null,0),void 0):r.sadd(t,n)}).then(function(){r._keys[key]=3,u.resolve(1),i(null,1)},function(e){u.reject(e),i(e)}),u},l.srandmember=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise(a);return this.exists(e).then(function(i){return i?t.get(e):(r.resolve(null),void n(null,null))}).then(function(e){var t=Math.floor(Math.random()*e.length)||0,i=e[t];r.resolve(i),n(null,i)},function(e){r.reject(e),n(e)}),r},l.spop=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?a:arguments[1],r=new o.Promise(a);r.then(function(n){return t.emit("spop",e,n)});var i=null;return this.exists(e).then(function(i){return i?t.srandmember(e):(r.resolve(null),void n(null,null))}).then(function(n){return i=n,t.srem(e,i)}).then(function(){r.resolve(i),n(null,i)},function(e){r.reject(e),n(e)}),r},l.sunion=function(){for(var e=this,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];var i=new o.Promise(a),u=a,l=null;n[n.length-1]instanceof Function&&(u=n.pop());var c=[](l=function(t){var r=n[t];r?e.exists(r).then(function(n){return n?e.get(r):void l(++t)}).then(function(e){Array.isArray(e)&&(c=c.concat(e)),l(++t)},function(e){return i.reject(e),u(e)}):(c=s["default"].arrayUnique(c),i.resolve(c),u(null,c))})(0);return i},l.sunionstore=function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),u=1;n>u;u++)r[u-1]=arguments[u];var s=new o.Promise(a),l=a;s.then(function(n){var u=i(n,2),s=u[0],o=u[1];return t.emit("sunionstore",e,r,s,o)}),r[r.length-1]instanceof Function&&(l=r.pop());var c=null;return this.sunion(r).then(function(n){return c=n,t.exists(e)}).then(function(n){return n?t.del(e):t.sadd(e,c)}).then(function(n){return"number"!=typeof n?t.sadd(e,c):(s.resolve([n,c]),void l(null,n,c))}).then(function(e){s.resolve(e,c),l(null,e,c)},function(e){s.reject(e),l(e)}),s},l.sinter=function(){for(var e=this,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];var i=new o.Promise(a),u=a,l=null;n[n.length-1]instanceof Function&&(u=n.pop());var c=[](l=function(t){var r=n[t];if(r)e.exists(r).then(function(n){return n?e.get(r):void l(++t)}).then(function(e){Array.isArray(e)&&c.push(e),l(++t)},function(e){return i.reject(e),u(e)});else{var o=s["default"].arrayInter.apply(s["default"],c);i.resolve(o),u(null,o)}})(0);return i},l.sinterstore=function(e){for(var t=this,n=new o.Promise(a),r=a,i=arguments.length,u=Array(i>1?i-1:0),s=1;i>s;s++)u[s-1]=arguments[s];u[u.length-1]instanceof Function&&(r=u.pop());var l=null;return this.sinter.apply(this,u).then(function(n){return l=n,t.exists(e)}).then(function(n){return n?t.del(e):(l.unshift(e),t.sadd.apply(t,l))}).then(function(i){return"string"!=typeof i?t.sadd(e,l):(n.resolve(l.length,l),void r(null,l.length,l))}).then(function(){n.resolve(l.length,l),r(null,l.length,l)},function(e){n.reject(e),r(e)}),n},l.sdiff=function(){for(var e=this,t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];var i=new o.Promise(a),u=a,l=null;n[n.length-1]instanceof Function&&(u=n.pop());var c=[](l=function(t){var r=n[t];if(r)e.exists(r).then(function(n){return n?e.get(r):void l(++t)}).then(function(e){Array.isArray(e)&&c.push(e),l(++t)},function(e){return i.reject(e),u(e)});else{var o=s["default"].arrayDiff.apply(s["default"],c);i.resolve(o),u(null,o)}})(0);return i},l.sdiffstore=function(e){for(var t=this,n=new o.Promise(a),r=a,i=arguments.length,u=Array(i>1?i-1:0),s=1;i>s;s++)u[s-1]=arguments[s];u[u.length-1]instanceof Function&&(r=u.pop());var l=null;return this.sdiff(u).then(function(n){return l=n,t.exists(e)}).then(function(n){return n?t.del(e):t.sadd(e,l)}).then(function(i){return"number"!=typeof i?t.sadd(e,l):(n.resolve(i,l),void r(null,i,l))}).then(function(e){n.resolve(e,l),r(null,e,l)},function(e){n.reject(e),r(e)}),n},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),u=r(i),s=n(3),o=u["default"].noop,a={};t["default"]=a,a.zadd=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],u=new s.Promise(o);return u.then(function(i){return r.emit("zadd",e,t,n,i)}),this.exists(e).then(function(i){if(i)return r.get(e);var u={};return u[t]=[0],r.set(e,{ms:[n],hsm:{0:t},shm:u})}).then(function(s){var o=s[0];if("string"==typeof o)r._keys[e]=4,u.resolve(1,1),i(null,1,1);else if("object"==typeof o){var a=o;if(a.ms.indexOf(n)>=0){var l=a.ms.length;return u.resolve(0,l),i(null,0,l)}var c=a.ms.length;return a.ms.push(n),a.hsm[c]=t,Array.isArray(a.shm[t])?a.shm[t].push(c):a.shm[t]=[c],r.set(e,a)}}).then(function(e,t){r._keys[e]=4;var n=t.ms.length;u.resolve(1,n),i(null,1,n)},function(e){u.reject(e),i(e)}),u},a.zcard=function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?o:arguments[1],r=new s.Promise(o);return this.exists(e).then(function(i){if(i)return t.get(e);var u=new Error("no such key");r.reject(u),n(u)}).then(function(e){var t=e.ms.filter(Boolean).length;r.resolve(t),n(null,t)},function(e){r.reject(e),n(e)}),r},a.zcount=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],u=new s.Promise(o);return u.then(function(i){return r.emit("zcount",e,t,n,value,i)}),this.exists(e).then(function(t){if(t)return r.get(e);var n=new Error("no such key");u.reject(n),i(n)}).then(function(e){var r=Object.keys(e.shm).filter(function(e){return e>=t&&n>=e}).map(function(t){return e.shm[t]}),s=r.map(function(e){return e.length}).reduce(function(e,t){return e+t});u.resolve(s),i(null,s)},function(e){u.reject(e),i(e)}),u},a.zrem=function(e){for(var t=this,n=arguments.length,r=Array(n>1?n-1:0),i=1;n>i;i++)r[i-1]=arguments[i];var u=new s.Promise(o),a=o;r[r.length-1]instanceof Function&&(a=r.pop()),u.then(function(n){return t.emit("zrem",e,r,n)});var l=0;return this.exists(e).then(function(n){if(n)return t.get(e);var r=new Error("no such key");u.reject(r),a(r)}).then(function(e){var t=new s.Promise(o),n=!0,i=!1,u=void 0;try{for(var a,c=r[Symbol.iterator]();!(n=(a=c.next()).done);n=!0){var f=a.value,h=e.ms.indexOf(f);if(h>=0){e.ms[f]=0;var v=e.hsm[f];delete e.hsm[f];var m=e.shm[v].indexOf(f);m>=0&&e.shm[v].splice(m,1),l++}}}catch(g){i=!0,u=g}finally{try{!n&&c["return"]&&c["return"]()}finally{if(i)throw u}}return t.resolve(e),t}).then(function(n){return t.set(e,n)}).then(function(){u.resolve(l),a(null,l)},function(e){u.reject(e),a(null,e)}),u},a.zscore=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new s.Promise(o);return this.exists(e).then(function(t){if(t)return n.get(e);var u=new Error("no such key");i.reject(u),r(u)}).then(function(e){var n=e.ms.indexOf(t);if(n>=0){var u=e.hsm[n];i.resolve(u),r(null,u)}else{var s=new Error("This member does not be in the set");i.reject(s),r(s)}}),i},a.zrange=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],a=new s.Promise(o);return this.exists(e).then(function(t){if(t)return this.get(e);var n=new Error("no such key");a.reject(n),i(n)}).then(function(e){var r=Object.keys(e.shm).filter(function(e){return e>=t&&n>=e}).map(function(t){return e.shm[t]}),s=u["default"].flatten(r.map(function(t){return t.map(function(t){return e.ms[t]})})).reduce(function(e,t){return e.concat(t)});a.resolve(s),i(null,s)},function(e){a.reject(e),i(e)}),a.withScore=function(){var t=arguments.length<=0||void 0===arguments[0]?o:arguments[0],n=new s.Promise(o);return a.then(function(i){var u=r.multi();i.forEach(function(t){return u.zscore(e,t)}),u.exec(function(e,r){if(e)return t(e),n.reject(e);var u=r.map(function(e,t){return{member:i[t],score:e[0]}});n.resolve(u),t(null,u)})}),n},a},a.zrevrange=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],a=new s.Promise(o);return this.exists(e).then(function(t){if(t)return r.get(e);var n=new Error("no such key");a.reject(n),i(n)}).then(function(e){var r=Object.keys(e.shm).reverse().filter(function(e){return e>=t&&n>=e}).map(function(t){return e.shm[t]}),s=u["default"].flatten(r.map(function(t){return t.map(function(t){return e.ms[t]})})).reduce(function(e,t){return e.concat(t)});a.resolve(s),i(null,s)},function(e){a.reject(e),i(e)}),a.withScore=function(){var t=arguments.length<=0||void 0===arguments[0]?o:arguments[0],n=new s.Promise(o);return a.then(function(i){var u=r.multi();i.forEach(function(t){return u.zscore(e,t)}),u.exec(function(e,r){if(e)return t(e),n.reject(e);var u=r.map(function(e,t){return{member:i[t],score:e[0]}});n.resolve(u),t(null,u)})}),n},a},a.zincrby=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],u=new s.Promise(o);u.then(function(i){return r.emit("zincrby",e,t,n,i)});var a=null;return this.exists(e).then(function(s){return s?r.zscore(e,n):void r.zadd(e,t,n,i).then(u.resolve.bind(u),u.reject.bind(u))}).then(function(){return r.get(e)}).then(function(i){var u=i.ms.indexOf(n),s=i.hsm[u];a=s+t;var o=i.shm[s].indexOf(u);return i.shm[s].splice(o,1),i.hsm[u]=a,i.shm[a]?i.shm[a].push(u):i.shm[a]=[u],r.set(e,i)}).then(function(){u.resolve(a),i(null,a)},function(e){u.reject(e),i(e)}),u},a.zdecrby=function(e,t,n){var r=this,i=arguments.length<=3||void 0===arguments[3]?o:arguments[3],u=new s.Promise(o);u.then(function(e){return r.emit("zdecrby",keys,t,n,e)});var a=null;return this.exists(e).then(function(t){if(t)return r.zscore(e,n);var s=new Error("no such key");u.reject(s),i(s)}).then(function(){return r.get(e)}).then(function(i){var u=i.ms.indexOf(n),s=i.hsm[u];a=s-t;var o=i.shm[s].indexOf(u);return i.shm[s].splice(o,1),i.hsm[u]=a,i.shm[a]?i.shm[a].push(u):i.shm[a]=[u],r.set(e,i)}).then(function(){u.resolve(a),i(null,a)},function(e){u.reject(e),i(e)}),u},a.zrank=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new s.Promise(o);return this.exists(e).then(function(t){if(t)return n.get(e);var u=new Error("no such key");i.reject(u),r(u)}).then(function(e){var n=Object.keys(e.shm),u=e.hsm[e.ms.indexOf(t)],s=n.indexOf(u);i.resolve(s),r(null,s)},function(e){i.reject(e),r(e)}),i},a.zrevrank=function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?o:arguments[2],i=new s.Promise(o);return this.exists(e).then(function(t){if(t)return n.get(e);var u=new Error("no such key");i.reject(u),r(u)}).then(function(e){var n=Object.keys(e.shm),u=e.hsm[e.ms.indexOf(t)],s=n.reverse().indexOf(u);i.resolve(s),r(null,s)},function(e){i.reject(e),r(e)}),i},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(2),o=r(s),a=n(3),l=o["default"].noop,c={};t["default"]=c;var f=function(){function e(t){var n=this;i(this,e),this.queue=[],this.last=null,this.state=0,this.min=t;for(var r=Object.getOwnPropertyNames(t),u=0;u<r.length;u++){var s=r[u];"function"==typeof t[s]&&!function(e){n[e]=function(){for(var t=arguments.length,r=Array(t),i=0;t>i;i++)r[i]=arguments[i];return n.queue.push({method:e,args:r}),n}}(s)}}return u(e,[{key:"exec",value:function(){var e=arguments.length<=0||void 0===arguments[0]?l:arguments[0],t=this,n=new a.Promise,r=[];return function i(u){u?t.min[u.method].apply(t.min,u.args).then(function(){for(var e=arguments.length,n=Array(e),u=0;e>u;u++)n[u]=arguments[u];r.push(n),i(t.queue.shift())},function(t){n.reject(t),e(t,r)}):(n.resolve(r),e(null,r))}(this.queue.shift()),n}}]),e}();c.multi=function(){return new f(this)};var h=function(){function e(t,n){var r=this,u=arguments.length<=2||void 0===arguments[2]?l:arguments[2];i(this,e);var s=null;this.min=n,this.callback=u,this.result=[],this.keys={},this.promise=new a.Promise(l),this.sortFn=function(e,t){return o["default"].isNumber(e)&&o["default"].isNumber(t)?e-t:JSON.stringify(e)>JSON.stringify(t)};var c=function(){r.min.exists(t).then(function(e){return e?r.min.get(t):new Error("no such key")}).then(function(e){var t=new a.Promise(l);switch(!0){case Array.isArray(e):t.resolve(e);break;case e.ms&&Array.isArray(e.ms):t.resolve(e.ms);break;default:return new Error("content type wrong")}return t}).then(function(e){r.result=e.sort(r.sortFn),r.result.forEach(function(e){r.keys[e]=e}),r.promise.resolve(r.result),r.callback(null,r.result)},function(e){r.promise.reject(e),r.callback(e)})}(s=function(e){var t=e.shift();t?(r[t]=function(){for(var e=arguments.length,n=Array(e),i=0;e>i;i++)n[i]=arguments[i];return r.promise[t].apply(r.promise,n)},s(e)):c()})(["then","done"])}return u(e,[{key:"by",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?l:arguments[1],r={},i=[],u=null;if(e.indexOf("->")>0){var s=e.indexOf("->");u=e.substr(s+2),e=e.substr(0,e.length-s)}return this.min.keys(e).then(function(n){for(var u=new RegExp(e.replace("?","(.)").replace("*","(.*)")),s=0;s<n.length;s++){var o=u.exec(n[s])[1];t.result.indexOf(o)>=0&&(r[n[s]]=o)}return i=Object.keys(r),t.min.mget(i.slice())}).then(function(e){for(var u={},s=0;s<e.length;s++)u[JSON.stringify(e[s])]=i[s];e.sort(t.sortFn);var o=e.map(function(e){return u[JSON.stringify(e)]}).map(function(e){return r[e]});t.result=o,t.promise.resolve(o),n(null,o)},function(e){t.promise.reject(e),n(e),t.callback(e)}),this}},{key:"asc",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?l:arguments[0];this.sortFn=function(e,t){return o["default"].isNumber(e)&&o["default"].isNumber(t)?e-t:JSON.stringify(e)>JSON.stringify(t)};var n=function(n){e.result=n.sort(e.sortFn),e.promise.resolve(e.result),t(null,e.result)};return this.promise.ended?n(this.result):this.promise.once("resolve",n),this}},{key:"desc",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?l:arguments[0];this.sortFn=function(e,t){return o["default"].isNumber(e)&&o["default"].isNumber(t)?t-e:JSON.stringify(e)<JSON.stringify(t)};var n=function(n){e.result=n.sort(e.sortFn),e.promise.resolve(e.result),t(null,e.result)};return this.promise.ended?n(this.result):this.promise.once("resolve",n),this}},{key:"get",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?l:arguments[1],r=function(r){var i=[],u=null(u=function(r){var s=r.shift();if(o["default"].isUndefined(s))t.result=i,t.promise.resolve(i),n(null,i);else if(Array.isArray(s)){var a=t.keys[s[0]];t.min.get(e.replace("*",a)).then(function(e){s.push(e),i.push(s),u(r)},function(e){t.promise.reject(e),n(e)})}else if(s.substr||o["default"].isNumber(s)){var a=t.keys[s];t.min.get(e.replace("*",a)).then(function(e){i.push([e]),e.substr||o["default"].isNumber(e)?t.keys[e]=a:t.keys[JSON.stringify(e)]=a,u(r)},function(e){t.promise.reject(e),n(e)})}})(r.slice())};return this.promise.ended?r(this.result):this.promise.once("resolve",r),this}},{key:"hget",value:function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?l:arguments[2],i=function(i){var u=[],s=null(s=function(i){var a=i.shift();if(o["default"].isUndefined(a))n.result=u,n.promise.resolve(u),r(null,u);else if(Array.isArray(a)){var l=n.keys[a[0]];n.min.hget(e.replace("*",l),t).then(function(e){a.push(e),u.push(a),s(i)},function(e){n.promise.reject(e),r(e)})}else if(a.substr||o["default"].isNumber(a)){var l=n.keys[a];n.min.hget(e.replace("*",l)).then(function(e){u.push([e]),e.substr||o["default"].isNumber(e)?n.keys[e]=l:n.keys[JSON.stringify(e)]=l,s(i)},function(e){n.promise.reject(e),r(e)})}})(i.slice())};return this.promise.ended?i(this.result):this.promise.once("resolve",i),this}},{key:"limit",value:function(e,t){var n=this,r=arguments.length<=2||void 0===arguments[2]?l:arguments[2],i=function(i){n.result=i.splice(e,t),n.promise.resolve(n.result),r(null,n.result)};return this.promise.ended?i(this.result):this.promise.once("resolve",i),this}},{key:"flatten",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?l:arguments[0];if(this.promise.ended){for(var n=[],r=0;r<this.result.length;r++)for(var i=0;i<this.result[r].length;i++)n.push(this.result[r][i]);this.result=n,this.promise.resolve(n),t(null,n)}else this.promise.once("resolve",function(n){for(var r=[],i=0;i<n.length;i++)for(var u=0;u<n[i].length;u++)r.push(n[i][u]);e.result=r,e.promise.resolve(r),t(null,r)});return this}},{key:"store",value:function(e){var t=this,n=arguments.length<=1||void 0===arguments[1]?l:arguments[1];return this.promise.ended?this.min.set(e,this.result).then(function(){t.promise.resolve(t.result),n(null,t.result)},function(e){t.promise.reject(e),n(e)}):this.promise.once("resolve",function(r){t.min.set(e,r).then(function(){t.promise.resolve(r),n(null,r)},function(e){t.promise.reject(e),n(e)})}),this}}]),e}();c.sort=function(e){var t=arguments.length<=1||void 0===arguments[1]?l:arguments[1];return new h(e,void 0,t)};var v=function(){function e(t,n,r,u){i(this,e),n=n||"*",this.cursor=t||0,this.pattern=new RegExp(n.replace("*","(.*)")),this.limit=r>-1?r:10,this.end=this.cursor,this.parent=u}return u(e,[{key:"scan",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?l:arguments[0],n=[];return this.parent.get("min_keys").then(function(r){r=JSON.parse(r);var i=null,u=Object.keys(r)(i=function(r){var s=u[r];if(s&&e.pattern.test(s)&&"min_keys"!==s){if(n.push(s),++e.end-e.cursor>=e.limit)return t(null,n,e.end)}else if(!s)return e.end=0,t(null,n,e.end);return i(++r)})(e.cursor)},function(e){t(e)}),this}},{key:"match",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?l:arguments[1];return this.pattern=new RegExp(e.replace("*","(.*)")),this.end=this.cursor,this.scan(t)}},{key:"count",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?l:arguments[1];return this.limit=e,this.end=this.cursor,this.scan(t)}}]),e}();c.scan=function(e){var t=arguments.length<=1||void 0===arguments[1]?l:arguments[1],n=new v(e,null,-1,void 0);return n.scan(t),n},e.exports=t["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){n(this,e)}return r(e,[{key:"get",value:function(e){return sessionStorage?sessionStorage.getItem(e):!1}},{key:"set",value:function(e,t){return sessionStorage?sessionStorage.setItem(e,t):!1}},{key:"remove",value:function(e){return sessionStorage?sessionStorage.removeItem(e):!1}}]),e}();t.memStore=i;var u=function(){function e(){n(this,e)}return r(e,[{key:"get",value:function(e){return localStorage?localStorage.getItem(e):!1}},{key:"set",value:function(e,t){return localStorage?localStorage.setItem(e,t):!1}},{key:"remove",value:function(e){return localStorage?localStorage.removeItem(e):!1}}]),e}();t.localStore=u}])});